<!doctype html>
<html lang="zh-CN">
<head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    
    <meta name="referrer" content="no-referrer-when-downgrade">
    

    <title>基于Apache james实现的Java邮件服务器 | Adiosy&#39;s blog</title>
    <meta property="og:title" content="基于Apache james实现的Java邮件服务器 - Adiosy&#39;s blog">
    <meta property="og:type" content="article">
        
    <meta property="article:published_time" content='2018-01-02T14:34:07&#43;08:00'>
        
        
    <meta property="article:modified_time" content='2018-01-02T14:34:07&#43;08:00'>
        
    <meta name="Keywords" content="C/C&#43;&#43;,Java,计算机图形学,渲染,动画">
    <meta name="description" content="基于Apache james实现的Java邮件服务器">
        
    <meta name="author" content="xingchen">
    <meta property="og:url" content="http://www.adiosy.com/posts/%E9%82%AE%E4%BB%B6%E6%9C%8D%E5%8A%A1%E5%99%A8.html">
    <link rel="shortcut icon" href='/favicon.ico'  type="image/x-icon">

    <link rel="stylesheet" href='/css/normalize.css'>
    <link rel="stylesheet" href='/css/style.css'>
    <script type="text/javascript" src="//cdn.bootcdn.net/ajax/libs/jquery/3.4.1/jquery.min.js"></script>

    
    
    
        <link href="https://cdn.bootcdn.net/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.css" rel="stylesheet">
    
    
    
    
        <link rel="stylesheet" href='/css/custom.css'>
    
</head>

<body>
    <header id="header" class="clearfix">
    <div class="container">
        <div class="col-group">
            <div class="site-name ">
                
                    <a id="logo" href="http://www.adiosy.com">
                        Adiosy&#39;s blog
                    </a>
                
                <p class="description">民间图形学爱好者.</p>
            </div>
            <div>
                <nav id="nav-menu" class="clearfix">
                    <a class="current" href="http://www.adiosy.com">Home</a>
                    
                    <a  href="http://www.adiosy.com/archives.html" title="归档">归档</a>
                    
                    <a  href="http://www.adiosy.com/books.html" title="读书">读书</a>
                    
                    <a  href="http://www.adiosy.com/about.html" title="关于">关于</a>
                    
                </nav>
            </div>
        </div>
    </div>
</header>

    <div id="body">
        <div class="container">
            <div class="col-group">

                <div class="col-8" id="main">
                    
<div class="res-cons">
    <style type="text/css">
    .post-toc {
        position: fixed;
        width: 200px;
        margin-left: -210px;
        padding: 5px 0px;
        font-family: Athelas, STHeiti, Microsoft Yahei, serif;
        font-size: 20px;
        word-wrap: break-word;
        white-space: nowrap;
        z-index: 999;
        cursor: pointer;
        overflow-y: auto;
        overflow-x: hidden;
    }

    .post-toc .post-toc-title {
        width: 100%;
        margin: 0 auto;
        font-size: 20px;
        font-weight: bold;
        text-transform: uppercase;
        text-align: center;
    }

    .post-toc .post-toc-content {
        font-size: 13px;
         
        filter: drop-shadow(rgb(150, 150, 150) 0px 0px 6px) !important;
    }

    .post-toc .post-toc-content>nav>ul {
        margin: 10px 0;
        list-style: none;
        padding-inline-start: 1px !important;
    }

    .post-toc .post-toc-content ul {
        list-style: none;
        margin: 0.5em;
        line-height: 1.8em;
    }

    .post-toc .post-toc-content ul ul {
        padding-left: 15px;
        display: inherit;
    }

    .post-toc .post-toc-content>nav>ul>li{
        background-color: #fff;
        border-left: 5px solid #666;
        padding: 2px 5px 2px 5px;
    }

    .post-toc .post-toc-content ul li:hover{
 
 
    }

    .post-toc .post-toc-content ul li a{
        display: inline-block;
        width: 100%;
    }

    .post-toc .post-toc-content ul li a:hover{
        background-color: #666;
        color: #fff;
    }

    @media print,
    screen and (max-width:1057px) {
        .post-toc {
            display: none;
        }
    }
</style>
<div class="post-toc" style="position: absolute; top: 153px;">
    <h2 class="post-toc-title">目录</h2>
    <div class="post-toc-content">
        <nav id="TableOfContents">
  <ul>
    <li><a href="#什么是邮件服务器">什么是邮件服务器</a>
      <ul>
        <li><a href="#易邮邮件服务">易邮邮件服务</a></li>
        <li><a href="#apache-james">Apache james</a></li>
      </ul>
    </li>
    <li><a href="#windows平台安装配置">Windows平台安装配置</a>
      <ul>
        <li><a href="#下载解压">下载，解压</a></li>
        <li><a href="#配置开始">配置开始</a></li>
      </ul>
    </li>
    <li><a href="#linux平台安装配置">Linux平台安装配置</a>
      <ul>
        <li><a href="#上传安装包-解压">上传安装包 解压</a></li>
        <li><a href="#首次启动">首次启动</a></li>
        <li><a href="#配置">配置</a></li>
        <li><a href="#foxmail测试">Foxmail测试</a></li>
      </ul>
    </li>
    <li><a href="#常见的坑">常见的坑</a></li>
    <li><a href="#总结">总结</a></li>
  </ul>
</nav>
    </div>
</div>
<script type="text/javascript">
    $(document).ready(function () {
        var postToc = $(".post-toc");
        if (postToc.length) {
            var leftPos = $("#main").offset().left;
            if (leftPos < 220) {
                postToc.css({ "width": leftPos - 15, "margin-left": (0 - leftPos) })
            }

            var t = postToc.offset().top - 125,
                a = {
                    start: {
                        position: "absolute",
                        top: t
                    },
                    process: {
                        position: "fixed",
                        top: 125
                    },
                };

            var e = $(window).animate({scrollTop: 0}, 600);
            e < t ? postToc.css(a.start) : postToc.css(a.process);
        }

        if ($("#TableOfContents").children().length < 1) {
            $(".post-toc").remove();
        }
    })
</script>

    <article class="post">
        <header>
            <h1 class="post-title">基于Apache james实现的Java邮件服务器</h1>
        </header>
        
  <time datetime="2018-01-02T06:34:07Z" class="post-meta meta-date dt-published">
    2018-01-02
  </time>



        
        <div class="post-meta">
            <span id="busuanzi_container_page_pv">&nbsp;|
                <span id="busuanzi_value_page_pv"></span> <span>reads</span>
            </span>
        </div>
        
        
        <div class="clear" style="display: none">
            <div class="toc-article">
                <div class="toc-title">Table of Contents</div>
            </div>
        </div>
        
        <div class="post-content">
            <h2 id="什么是邮件服务器">什么是邮件服务器</h2>
<p>邮件服务器是一种用来负责电子邮件收发管理的设备，而邮件服务就是责邮件的收信和发信功能，其最主要有<code>pop和smtp</code>两个协议。关于这两个协议，有着很多的知识点涵盖其中，这里不过多介绍。下面是我接触过的两个可以实现邮件服务的解决方案。</p>
<h3 id="易邮邮件服务">易邮邮件服务</h3>
<p>在windows系统下，可以使用 易邮邮件服务 ，这个服务器简单而且实用，用在平时开发，测试或者局域网间的邮件收发还是挺方便的，不过我没有找到官方的，可以将易邮邮件服务安装在Linux的相关资料，因此不使用这个。这是易邮邮件服务的官方网站地址: <a href="https://www.eyousoft.net/">https://www.eyousoft.net/</a></p>
<h3 id="apache-james">Apache james</h3>
<p>Apache 应该都不陌生，开源免费，对于我们开发者来说是最好的家园。当时我项目需要时，一直在找邮件服务相关资料，于是找到了它。Apache James相关资料不多，所以希望写篇博客将其记录。以备以后用到，也对邮件服务能够有更深入的理解。这是官方的介绍</p>
<blockquote>
<p>James stands for Java Apache Mail Enterprise Server!
It has a modular architecture based on a rich set of modern and efficient components which provides at the end complete, stable, secure and extendable Mail Servers running on the JVM.</p>
</blockquote>
<p>通过介绍，不难看出，James小巧，可扩展而又不失强大，其支持pop，smtp以及相关SSL/TLS加密协议。可以用做开发测试，也可以对其扩展封装后作为企业级邮件服务。不过有一点需要说明的是，现在国内的很多云服务器是默认关闭 25 端口的，也就是默认不能使用未加密的 smtp 发送邮件，据说是为了减少垃圾邮件的产生。下图是其云服务提供商的解释截图（这个问题我自己找了很久，当时在本机测试代码完全没问题，但发布到服务器发现项目无法启动，最后无法解决，就用了AWS亚马逊云服务器作为邮件服务器测试，最终成功）。如果服务器是国内云服务器，需要实现和外网（如QQ,163邮件服务）之间收发邮件的话，只有三个办法：
1.申请开通25端口。不过申请基本不会通过&hellip;
2.使用加密的smtp协议传输。其端口则可以使用 465 等，避免使用25端口。
3.使用aws服务器。网上也听说会封25端口，不过我当时（2017年12月份末）测试时，还是可以使用的。</p>
<p>那么，我们现在搭建的邮件服务，如果不发布到云服务器或者企业独立的服务器，是无法收到外网邮件服务器发的邮件的，其实也很好理解，因为外网的服务器根本找不到你的邮件服务器在哪里，找不到你的机器IP地址。不过这不影响邮件<strong>发送</strong>，和<strong>局域网内的邮件收发</strong>功能。因此，以下的邮件服务搭建主要实现的功能就是：
1.局域网内的所有邮件收信和发信（普通邮件，Html邮件，附件邮件）；
2.外网的邮件发送（如果有条件测试邮件接收功能是最好的）。</p>
<p>将会分别在Windows平台和Linux平台搭建。</p>
<h2 id="windows平台安装配置">Windows平台安装配置</h2>
<blockquote>
<p>说明：本机测试使用的是 win10系统</p>
</blockquote>
<h3 id="下载解压">下载，解压</h3>
<p>下载地址： <a href="https://james.apache.org/download.cgi">https://james.apache.org/download.cgi</a></p>
<h3 id="配置开始">配置开始</h3>
<p>首先，前往 <strong><code>james-2.3.2.1\bin</code></strong> 找到 <strong><code>run.bat</code></strong>，双击启动，会发现启动以后窗口自动关闭，这是因为没有配置的原因，可能会启动失败，不过不要紧，这一次启动会生成一个文件，它就在 **<code>james-2.3.2.1\apps\james\SAR-INF\</code>**目录下，文件名 <strong><code>config.xml</code></strong>,现在配置的重点就是这个文件（如果不启动一次，这个文件是没有的）。</p>
<p>#####配置config.xml</p>
<p>修改xml代码，将所有localhost 替换为你的邮箱域名，这个可以随便写一个，等会配置一下hosts文件，将域名指向本机，即可将本机的james作为邮件服务器。</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-xml" data-lang="xml"><span style="color:#177500">&lt;!-- 配置这里，将这个xml文件的localhost替换成你的域名(这里测试使用xingchen.cn)--&gt;</span>
<span style="color:#000">&lt;postmaster&gt;</span>Postmaster@xingchen.cn<span style="color:#000">&lt;/postmaster&gt;</span>
</code></pre></div><p>邮件数据存储选择，根据xml来看，提供的有3中数据存储方式：
1.file:// 文件存储
2.db:// 数据库存储
3.dbfile:// 数据文件式存储</p>
<p>这些数据存储方式可以根据自己实际需求来定，不过如果选择文件存储方式，在启动时会出现找不到文件等错误，所以需要确认已经创建好文件夹再启动。当时为了方便，所以选择的是数据库存储方式，数据库使用Mysql数据库存储，因此需要作一下代码变更。如果你不需要使用数据库存储，就可以跳过数据库相关配置，包括 驱动包的导入，DBCP连接池配置等。</p>
<p>Mysql数据库配置 1：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-xml" data-lang="xml"><span style="color:#177500">&lt;!-- 	重要说明：	注释掉默认的  file://  ，这个在文件中有好几处地方，修改方式雷同，都要注释掉默认的这个，再打开数据库存储方式的配置
</span><span style="color:#177500">&lt;inboxRepository&gt;
</span><span style="color:#177500">	&lt;repository destinationURL=&#34;file://var/mail/inboxes/&#34; type=&#34;MAIL&#34;/&gt;
</span><span style="color:#177500">	&lt;/inboxRepository&gt;
</span><span style="color:#177500">--&gt;</span>

<span style="color:#177500">&lt;!--使用数据库作为数据存储--&gt;</span>
<span style="color:#000">&lt;inboxRepository&gt;</span>
	<span style="color:#000">&lt;repository</span> <span style="color:#836c28">destinationURL=</span><span style="color:#c41a16">&#34;db://maildb/inbox/&#34;</span> <span style="color:#836c28">type=</span><span style="color:#c41a16">&#34;MAIL&#34;</span><span style="color:#000">/&gt;</span>
<span style="color:#000">&lt;/inboxRepository&gt;</span>
</code></pre></div><p>Mysql数据库配置 2：
将mysql的驱动包拷贝到 **<code>james2.3.2\lib</code>**目录下</p>
<p>Mysql数据库配置 3：
找到 <code>&lt;data-source&gt;</code> 节点 配置数据库连接</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-xml" data-lang="xml"><span style="color:#000">&lt;data-source</span> <span style="color:#836c28">name=</span><span style="color:#c41a16">&#34;maildb&#34;</span> <span style="color:#836c28">class=</span><span style="color:#c41a16">&#34;org.apache.james.util.dbcp.JdbcDataSource&#34;</span><span style="color:#000">&gt;</span>

	<span style="color:#000">&lt;driver&gt;</span>com.mysql.jdbc.Driver<span style="color:#000">&lt;/driver&gt;</span>

	<span style="color:#000">&lt;dburl&gt;</span>jdbc:mysql://127.0.0.1/mail?autoReconnect=true<span style="color:#000">&lt;/dburl&gt;</span>

	<span style="color:#000">&lt;user&gt;</span>username<span style="color:#000">&lt;/user&gt;</span>

	<span style="color:#000">&lt;password&gt;</span>password<span style="color:#000">&lt;/password&gt;</span>

	<span style="color:#000">&lt;max&gt;</span>20<span style="color:#000">&lt;/max&gt;</span>

<span style="color:#000">&lt;/data-source&gt;</span>
</code></pre></div><p>Mysql数据库配置 4：在Mysql数据库中添加一个空的数据库 mail ,数据库只能是mail,以后的数据都将会存储在这个数据库中。</p>
<p>找到 <code>&lt;administrator_accounts&gt;</code>,将<code>!changeme!</code>改掉,等会登录使用的就是这个密码。</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-xml" data-lang="xml"><span style="color:#000">&lt;administrator_accounts&gt;</span>

	<span style="color:#177500">&lt;!-- CHECKME! --&gt;</span>

	<span style="color:#177500">&lt;!-- Change the default login/password. --&gt;</span>

	<span style="color:#000">&lt;account</span> <span style="color:#836c28">login=</span><span style="color:#c41a16">&#34;root&#34;</span> <span style="color:#836c28">password=</span><span style="color:#c41a16">&#34;!changeme!&#34;</span><span style="color:#000">/&gt;</span>
<span style="color:#000">&lt;/administrator_accounts&gt;</span>
</code></pre></div><p>找到<code> &lt;servernames&gt;</code>,将两true改为false</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-xml" data-lang="xml"><span style="color:#000">&lt;servernames</span> <span style="color:#836c28">autodetect=</span><span style="color:#c41a16">&#34;false&#34;</span> <span style="color:#836c28">autodetectIP=</span><span style="color:#c41a16">&#34;false&#34;</span><span style="color:#000">&gt;</span>
	<span style="color:#177500">&lt;!-- CONFIRM? --&gt;</span>

	<span style="color:#000">&lt;servername&gt;</span>xingchen.cn<span style="color:#000">&lt;/servername&gt;</span>

<span style="color:#000">&lt;/servernames&gt;</span>
</code></pre></div><p>​</p>
<p>找到下面的代码，注释掉。</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-xml" data-lang="xml"><span style="color:#177500">&lt;!--
</span><span style="color:#177500">&lt;mailet match=&#34;InSpammerBlacklist=dnsbl.njabl.org.&#34; class=&#34;ToProcessor&#34;&gt;
</span><span style="color:#177500">
</span><span style="color:#177500">	&lt;processor&gt; spam &lt;/processor&gt;
</span><span style="color:#177500">
</span><span style="color:#177500">	&lt;notice&gt;550 Requested action not taken: rejected - see https://njabl.org/&lt;/notice&gt;
</span><span style="color:#177500">
</span><span style="color:#177500">&lt;/mailet&gt;
</span><span style="color:#177500">--&gt;</span>
</code></pre></div><p>​</p>
<p>配置 DNSServer, 使用Google 的 Public DNS (还可以使用阿里云的DNSServer，之前我测试没毛病，可以使用，查阅地址参考：https://baike.baidu.com/item/dns/427444?fr=aladdin#14 )： </p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-xml" data-lang="xml"><span style="color:#000">&lt;servers&gt;</span>
  <span style="color:#000">&lt;server&gt;</span>8.8.8.8<span style="color:#000">&lt;/server&gt;</span>         
  <span style="color:#000">&lt;server&gt;</span>8.8.4.4<span style="color:#000">&lt;/server&gt;</span> 
<span style="color:#000">&lt;/servers&gt;</span>
</code></pre></div><p>此时，再次运行 <code>run.bat </code>即可。如果看到以下界面，说明安装成功。</p>
<p><figure class="max-w-2xl mx-auto overflow-hidden">
    
    <a data-fancybox="gallery" href="./assets/1240-1678086526733-6.png">
        <img alt="服务器启动成功" src="./assets/1240-1678086526733-6.png" />
    </a>
    
    <figcaption class="p-2 text-center">服务器启动成功</figcaption>
</figure>
3.客户端登录</p>
<p>使用telnet指令登录</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">telnet localhost <span style="color:#1c01ce">4555</span>
<span style="color:#177500">#因为是本机服务，所以直接使用localhost连接邮件服务器</span>
</code></pre></div><p>4.添加用户</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">adduser <span style="color:#a90d91">test</span> <span style="color:#a90d91">test</span>
</code></pre></div><p>这个命令很简单，就是添加一个用户名为 <code>test@yourdomain.com</code> ，密码 test 的用户只要在注册一个用户，就可以实现邮件互发了。下面举例使用 Foxmail 测试邮件收发。</p>
<h4 id="windows测试邮件收发">Windows测试邮件收发</h4>
<p>1.测试工具 ： Foxmail客户端
2.前提：两个注册在你的邮件服务器的帐号
3.预计实现结果：正常收发邮件，包括普通文本、富文本格式和附件收发。</p>
<h5 id="注册帐号">注册帐号</h5>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">adduser test2 test2
</code></pre></div><p>因为上文中也提到，已经有一个帐号 test 了，所以这里添加另外一个，这里的密码已经加密，由James内部实现。你可以前往数据库 Mail 的users表中查看相关信息。如下图</p>
<p><figure class="max-w-2xl mx-auto overflow-hidden">
    
    <a data-fancybox="gallery" href="./assets/1240-1678086533632-9.png">
        <img alt="数据库显示" src="./assets/1240-1678086533632-9.png" />
    </a>
    
    <figcaption class="p-2 text-center">数据库显示</figcaption>
</figure></p>
<h5 id="foxmail设置">Foxmail设置</h5>
<p>安装，打开foxmail,将我们刚刚注册的两个用户添加进去。步骤如下：</p>
<p><figure class="max-w-2xl mx-auto overflow-hidden">
    
    <a data-fancybox="gallery" href="./assets/1240-1678086537766-12.png">
        <img alt="新建用户 1" src="./assets/1240-1678086537766-12.png" />
    </a>
    
    <figcaption class="p-2 text-center">新建用户 1</figcaption>
</figure></p>
<p><figure class="max-w-2xl mx-auto overflow-hidden">
    
    <a data-fancybox="gallery" href="./assets/1240-1678086540797-15.png">
        <img alt="新建用户 2" src="./assets/1240-1678086540797-15.png" />
    </a>
    
    <figcaption class="p-2 text-center">新建用户 2</figcaption>
</figure></p>
<p><figure class="max-w-2xl mx-auto overflow-hidden">
    
    <a data-fancybox="gallery" href="./assets/1240-1678086543357-18.png">
        <img alt="新建用户 3" src="./assets/1240-1678086543357-18.png" />
    </a>
    
    <figcaption class="p-2 text-center">新建用户 3</figcaption>
</figure></p>
<p>另一个号以此为例，创建即可。</p>
<h5 id="测试开始">测试开始</h5>
<p>第一封：普通文本</p>
<p><figure class="max-w-2xl mx-auto overflow-hidden">
    
    <a data-fancybox="gallery" href="./assets/1240-1678086546623-21.png">
        <img alt="邮件预览" src="./assets/1240-1678086546623-21.png" />
    </a>
    
    <figcaption class="p-2 text-center">邮件预览</figcaption>
</figure></p>
<p><figure class="max-w-2xl mx-auto overflow-hidden">
    
    <a data-fancybox="gallery" href="./assets/1240-1678086549471-24.png">
        <img alt="测试结果" src="./assets/1240-1678086549471-24.png" />
    </a>
    
    <figcaption class="p-2 text-center">测试结果</figcaption>
</figure></p>
<p>因为篇幅有限，富文本格式和附件收发测试就不截图了。本机测试可行，配置无误应该都没问题。</p>
<p><strong>至此，Windows环境下配置，测试完毕。其中比较繁琐的是 config.xml的修改配置，如果发现启动失败，报错情况。很大可能是这个配置未完整或者有误。在文章后面我会提供一个本机测试可用的 config.xml 文件。</strong></p>
<h2 id="linux平台安装配置">Linux平台安装配置</h2>
<blockquote>
<p>说明：Linux系统环境是 CentOS6.8  32位机器。</p>
</blockquote>
<h3 id="上传安装包-解压">上传安装包 解压</h3>
<p>软件包在上文已经提供，直接将 tar.gz 安装包下载下来，并上传至服务器解压即可。</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="color:#177500">#解压命令</span>
tar -zxvf james-binary-2.3.2.1.tar.gz
</code></pre></div><h3 id="首次启动">首次启动</h3>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">./run.sh
</code></pre></div><p>如果出现 <code>-bash: ./run.sh: Permission denied</code>,说明没有执行的权限，需要给当前用户添加一个可执行的权限。</p>
<p><figure class="max-w-2xl mx-auto overflow-hidden">
    
    <a data-fancybox="gallery" href="./assets/1240-1678086558703-27.png">
        <img alt="Linux第一次运行" src="./assets/1240-1678086558703-27.png" />
    </a>
    
    <figcaption class="p-2 text-center">Linux第一次运行</figcaption>
</figure></p>
<p>可以发现执行成功。此时 使用 Ctrl + C  终止程序 。</p>
<h3 id="配置">配置</h3>
<p>1.开始配置 <code>//apps/james/SAR-INF/config.xml</code> .具体配置和windows上配置大同小异，DNSServer使用Google 的 Public DNS ： </p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-xml" data-lang="xml"><span style="color:#000">&lt;servers&gt;</span>
  <span style="color:#000">&lt;server&gt;</span>8.8.8.8<span style="color:#000">&lt;/server&gt;</span>         
  <span style="color:#000">&lt;server&gt;</span>8.8.4.4<span style="color:#000">&lt;/server&gt;</span> 
<span style="color:#000">&lt;/servers&gt;</span>
</code></pre></div><p>2.同样，数据库相关也要根据你的服务器中安装的Mysql做相应配置。</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-xml" data-lang="xml"><span style="color:#000">&lt;data-source</span> <span style="color:#836c28">name=</span><span style="color:#c41a16">&#34;maildb&#34;</span> <span style="color:#836c28">class=</span><span style="color:#c41a16">&#34;org.apache.james.util.dbcp.JdbcDataSource&#34;</span><span style="color:#000">&gt;</span>
  <span style="color:#000">&lt;driver&gt;</span>com.mysql.jdbc.Driver<span style="color:#000">&lt;/driver&gt;</span>
  <span style="color:#000">&lt;dburl&gt;</span>jdbc:mysql://127.0.0.1/mail?autoReconnect=true<span style="color:#000">&lt;/dburl&gt;</span>
  <span style="color:#000">&lt;user&gt;</span>root<span style="color:#000">&lt;/user&gt;</span>
  <span style="color:#000">&lt;password&gt;</span>yourMysqlPwd<span style="color:#000">&lt;/password&gt;</span>
  <span style="color:#000">&lt;max&gt;</span>20<span style="color:#000">&lt;/max&gt;</span>
<span style="color:#000">&lt;/data-source&gt;</span>
</code></pre></div><p>3.将数据库驱动添加到 <code>//lib</code> 目录下。</p>
<p>4.创建数据库 mail</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">mysql&gt; create database mail;
Query OK, <span style="color:#1c01ce">1</span> row affected <span style="color:#000">(</span>0.00 sec<span style="color:#000">)</span>
</code></pre></div><p>5.启动</p>
<p>6.测试连接</p>
<p>可以使用本机或者别的电脑测试连接 4555端口，如下：</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">telnet 你的IP  <span style="color:#1c01ce">4555</span>
</code></pre></div><p><figure class="max-w-2xl mx-auto overflow-hidden">
    
    <a data-fancybox="gallery" href="./assets/1240-1678086563438-30.png">
        <img alt="Telnet登录" src="./assets/1240-1678086563438-30.png" />
    </a>
    
    <figcaption class="p-2 text-center">Telnet登录</figcaption>
</figure>]</p>
<p>似曾相识页面出来了，这样就可以添加用户，邮件收发啦&hellip;</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">adduser admin@yourdomain password
</code></pre></div><h3 id="foxmail测试">Foxmail测试</h3>
<p>此时，将刚新建的用户配置到foxmail客户端中即可收发所有邮件。</p>
<p>与上文的Windows测试大同小异，不细述。</p>
<h2 id="常见的坑">常见的坑</h2>
<p>1.报错一 ： <strong><code>java.io.IOException: 文件名、目录名或卷标语法不正确。</code></strong></p>
<p>原因：这个报错的原因是用户信息，邮件收发产生的数据存储路径有误，默认使用的是文件存储。</p>
<p>解决：参考文章前半部分</p>
<p>​	a. 找到 <strong>所有的 destinationURL</strong> ,默认配置的是 &lsquo;file://var/mail&hellip;.'，就是使用文件存储，这里将其注释。如下图所示：</p>
<p><figure class="max-w-2xl mx-auto overflow-hidden">
    
    <a data-fancybox="gallery" href="./assets/1240-1678086571406-33.png">
        <img alt="配置文件修改" src="./assets/1240-1678086571406-33.png" />
    </a>
    
    <figcaption class="p-2 text-center">配置文件修改</figcaption>
</figure></p>
<p>​	b.把数据库驱动添加到 //lib/ 目录下，我这里用的是Mysql,所以将 mysql-connector-java-5.1.39-bin.jar 添加到 lib 文件夹下。</p>
<p>​	c.在数据库中创建一个 名为  mail 的数据库。当再次运行后James内部就会自动创建几个表。如下:</p>
<p><figure class="max-w-2xl mx-auto overflow-hidden">
    
    <a data-fancybox="gallery" href="./assets/1240-1678086573830-36.png">
        <img alt="创建名为 mail 的数据库" src="./assets/1240-1678086573830-36.png" />
    </a>
    
    <figcaption class="p-2 text-center">创建名为 mail 的数据库</figcaption>
</figure></p>
<p>​	此时，再次启动，应该就成功了。</p>
<p>2.报错二 ： <code>om.mysql.jdbc.exceptions.jdbc4.MySQLSyntaxErrorException: Unknown database 'mail'</code></p>
<p>原因：没有创建数据库 mail ,创建即可解决。这是由这项配置决定的，需要确认填写无误，还有数据库驱动已加入其中即可避免。</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-xml" data-lang="xml"><span style="color:#000">&lt;data-source</span> <span style="color:#836c28">name=</span><span style="color:#c41a16">&#34;maildb&#34;</span> <span style="color:#836c28">class=</span><span style="color:#c41a16">&#34;org.apache.james.util.dbcp.JdbcDataSource&#34;</span><span style="color:#000">&gt;</span>
  <span style="color:#000">&lt;driver&gt;</span>com.mysql.jdbc.Driver<span style="color:#000">&lt;/driver&gt;</span>
  <span style="color:#000">&lt;dburl&gt;</span>jdbc:mysql://127.0.0.1/mail?autoReconnect=true<span style="color:#000">&lt;/dburl&gt;</span>
  <span style="color:#000">&lt;user&gt;</span>root<span style="color:#000">&lt;/user&gt;</span>
  <span style="color:#000">&lt;password&gt;</span>yourMysqlPwd<span style="color:#000">&lt;/password&gt;</span>
  <span style="color:#000">&lt;max&gt;</span>20<span style="color:#000">&lt;/max&gt;</span> 
<span style="color:#000">&lt;/data-source&gt;</span>
</code></pre></div><p>3.无法收发外网邮件</p>
<p>原因：这个错误原因会比较多，也很难总结，包括安装，配置，帐号等方面都有可能出问题。不过大多数还是配置出错引起的。可以参考这篇文章：<a href="https://www.cnblogs.com/softidea/p/5348057.html">Apache James使用的方法及相关心得（转）</a>，这是博客园上的文章，感谢原作者的分享和总结，当时我也是根据这篇文章解决无法的收发外网邮件的BUG。</p>
<p>4.说明：如果没有独立域名和服务器，没有独立的公网IP地址，无法真正做到收外网邮件,不过为了满足开发测试，可以在hosts文件中添加伪域名，实现其功能。</p>
<h2 id="总结">总结</h2>
<p>是的，又是造轮子，但是对于技术提升和代码实践还是很有帮助，可以更深理解别人的代码思想，技术逻辑。其实我一直觉得，技术对我来说，把坑挖得越深越好，理解越透彻越好，代码不在于多，而在于真正理解编程思想，解决实际问题。这才是编程的实际意义。</p>

        </div>

        
<div class="post-archive">
    <ul class="post-copyright">
        <li><strong>Author: </strong><a rel="author" href="http://www.adiosy.com">xingchen</a></li>
        <li style="word-break:break-all"><strong>Link: </strong><a href="http://www.adiosy.com/posts/%E9%82%AE%E4%BB%B6%E6%9C%8D%E5%8A%A1%E5%99%A8.html">http://www.adiosy.com/posts/%E9%82%AE%E4%BB%B6%E6%9C%8D%E5%8A%A1%E5%99%A8.html</a></li>
        <li><strong>License: </strong>This work is under a <a rel="license" href="https://creativecommons.org/licenses/by-nc-nd/4.0/">知识共享署名-非商业性使用-禁止演绎 4.0 国际许可协议</a>. Kindly fulfill the requirements of the aforementioned License when adapting or creating a derivative of this work.</li>
    </ul>
</div>
<br/>



        

<div class="post-archive">
    <h2>See Also</h2>
    <ul class="listing">
        
        <li><a href="/posts/linux%E4%B8%8B%E5%AE%89%E8%A3%85nginx.html">Linux下安装Nginx</a></li>
        
        <li><a href="/posts/liunx%E4%B8%8B%E7%9A%84jdk%E5%92%8Cmysql%E5%AE%89%E8%A3%85.html">Liunx下的JDK和MySQL安装</a></li>
        
        <li><a href="/posts/springboot%E5%92%8Cjpa%E6%90%AD%E5%BB%BAdemo.html">Springboot和JPA搭建demo</a></li>
        
        <li><a href="/about.html">关于</a></li>
        
        <li><a href="/archives.html">归档</a></li>
        
    </ul>
</div>


        <div class="post-meta meta-tags">
            
            No tags
            
        </div>
    </article>
    
    

    
    
    <div class="post bg-white">
      <script src="https://utteranc.es/client.js"
            repo= "xingchen0085/doc"
            issue-term="pathname"
            theme="github-light"
            crossorigin="anonymous"
            async>
      </script>
    </div>
    
    
    

</div>

                    <footer id="footer">

    
    <div>
        <div class="github-badge">
            <a href="https://gohugo.io/" target="_black" rel="nofollow"><span class="badge-subject">Powered by</span><span class="badge-value bg-blue">Hugo</span></a>
        </div>
        <div class="github-badge">
            <a href="https://www.flysnow.org/" target="_black"><span class="badge-subject">Design by</span><span class="badge-value bg-brightgreen">飞雪无情</span></a>
        </div>
        <div class="github-badge">
            <a href="https://github.com/flysnow-org/maupassant-hugo" target="_black"><span class="badge-subject">Theme</span><span class="badge-value bg-yellowgreen">Maupassant</span></a>
        </div>
    </div>

    <br />
        
        <div>
            <span id="busuanzi_container_site_uv" style="font-family: auto;">
              本站访客数<span id="busuanzi_value_site_uv"></span>人次
            </span>
            &copy; 2024 <a href="http://www.adiosy.com">Adiosy&#39;s blog By xingchen</a>
                
    </div>
</footer>


    
    <script src="//cdnjs.cloudflare.com/ajax/libs/raphael/2.2.8/raphael.min.js" crossorigin="anonymous"></script>
        <script src="//cdnjs.cloudflare.com/ajax/libs/flowchart/1.12.2/flowchart.min.js" crossorigin="anonymous"></script>
        <script>(function () {
                if (!window.flowchart) return;
                const blocks = document.querySelectorAll('pre code.language-flowchart, pre code.language-flow');
                for (let i = 0; i < blocks.length; i++) {
                    const block = blocks[i];
                    const rootElement = block.parentNode;
                    const container = document.createElement('div');
                    const id = `js-flowchart-diagrams-${i}`;
                    container.id = id;
                    container.className = 'align-center';
                    container.setAttribute("style", "overFlow-x:auto");
                    rootElement.parentNode.replaceChild(container, rootElement);
                    const diagram = flowchart.parse(block.childNodes[0].nodeValue);
                    diagram.drawSVG(id, window.flowchartDiagramsOptions ? window.flowchartDiagramsOptions : {});
                }
            })();
        </script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/webfont/1.6.28/webfontloader.js" crossorigin="anonymous"></script>
        <script src="//cdnjs.cloudflare.com/ajax/libs/snap.svg/0.5.1/snap.svg-min.js" crossorigin="anonymous"></script>
        <script src="//cdnjs.cloudflare.com/ajax/libs/underscore.js/1.9.1/underscore-min.js" crossorigin="anonymous"></script>
        <script src="//cdnjs.cloudflare.com/ajax/libs/js-sequence-diagrams/1.0.6/sequence-diagram-min.js" crossorigin="anonymous"></script>
        <script>(function () {
            if (!window.Diagram) return;
            const blocks = document.querySelectorAll('pre code.language-sequence');
            for (let i = 0; i < blocks.length; i++) {
                const block = blocks[i];
                
                const rootElement = block.parentNode;
                const container = document.createElement('div');
                const id = `js-sequence-diag-${i}`;
                container.id = id;
                container.className = 'align-center';
                container.setAttribute("style", "overFlow-x:auto");
                rootElement.parentNode.replaceChild(container, rootElement);

                const diagram = Diagram.parse(block.childNodes[0].nodeValue);
                diagram.drawSVG(id, window.sequenceDiagramsOptions
                    ? window.sequenceDiagramsOptions
                    : { theme: 'simple' });
            }
        })();
        </script><script type="text/javascript">
        window.MathJax = {
            tex2jax: {
                inlineMath: [['$', '$']],
                processEscapes: true
                }
            };
    </script>
    <script src='//cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML' async></script><script src="//cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.js"></script>

<a id="rocket" href="#top"></a>
<script type="text/javascript" src='/js/totop.js?v=0.0.0' async=""></script>
<style type="text/css">
div.highlight {
    position: relative;
    margin: 1em 0px;
}

.copy-code {
    display: none;
    position: absolute;
    top: 4px;
    right: 4px;
    color: rgba(255, 255, 255, 0.8);
    background: rgba(78, 78, 78, 0.8);
    border-radius: var(--radius);
    padding: 0 5px;
    font: inherit;
    user-select: none;
    cursor: pointer;
    border: 0;
    --radius: 8px;
}

div.highlight:hover .copy-code,pre:hover .copy-code {
    display: block;
}

</style>
<script>
    document.querySelectorAll('pre > code').forEach((codeblock) => {
        const container = codeblock.parentNode.parentNode;

        const copybutton = document.createElement('button');
        copybutton.classList.add('copy-code');
        copybutton.innerHTML = 'copy';

        function copyingDone() {
            copybutton.innerHTML = 'copied!';
            setTimeout(() => {
                copybutton.innerHTML = 'copy';
            }, 2000);
        }

        copybutton.addEventListener('click', (cb) => {
            if ('clipboard' in navigator) {
                navigator.clipboard.writeText(codeblock.textContent);
                copyingDone();
                return;
            }

            const range = document.createRange();
            range.selectNodeContents(codeblock);
            const selection = window.getSelection();
            selection.removeAllRanges();
            selection.addRange(range);
            try {
                document.execCommand('copy');
                copyingDone();
            } catch (e) { };
            selection.removeRange(range);
        });

        if (container.classList.contains("highlight")) {
            container.appendChild(copybutton);
        } else if (container.parentNode.firstChild == container) {
            
        } else if (codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName == "TABLE") {
            
            codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(copybutton);
        } else {
            
            codeblock.parentNode.appendChild(copybutton);
        }
    });
</script>


    <script type="text/javascript" src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" async></script>




                </div>

                <div id="secondary">
    <section class="widget">
        
<form id="search" action='http://www.adiosy.com/search' method="get" accept-charset="utf-8" target="_blank" _lpchecked="1">
      
      <input type="text" name="q" maxlength="20" placeholder="Search">
      <input type="hidden" name="sitesearch" value="http://www.adiosy.com">
      <button type="submit" class="submit icon-search"></button>
</form>
    </section>

    <section class="widget">
        <h3 class="widget-title">Latest articles</h3>
<ul class="widget-list">
    
    <li>
        <a href="http://www.adiosy.com/posts/android%E8%B7%A8%E8%BF%9B%E7%A8%8B%E6%B8%B2%E6%9F%93-hardwarebuffer.html" title="Android跨进程渲染-HardwareBuffer" target="_blank">Android跨进程渲染-HardwareBuffer</a>
    </li>
    
    <li>
        <a href="http://www.adiosy.com/posts/learn_vulkan/learn_vulkan03_%E6%B8%B2%E6%9F%93%E6%A1%86%E6%9E%B6%E5%AE%9E%E7%8E%B0_%E7%AA%97%E5%8F%A3%E5%92%8Cvulkan%E7%8E%AF%E5%A2%83.html" title="Learn_Vulkan03_渲染框架实现_窗口和Vulkan环境" target="_blank">Learn_Vulkan03_渲染框架实现_窗口和Vulkan环境</a>
    </li>
    
    <li>
        <a href="http://www.adiosy.com/posts/opengl%E6%88%96vulkan%E6%B8%B2%E6%9F%93yuv%E6%A0%BC%E5%BC%8F%E6%95%B0%E6%8D%AE.html" title="OpenGL或Vulkan渲染YUV格式数据" target="_blank">OpenGL或Vulkan渲染YUV格式数据</a>
    </li>
    
    <li>
        <a href="http://www.adiosy.com/posts/learn_vulkan/learn_vulkan02_%E6%B8%B2%E6%9F%93%E6%A1%86%E6%9E%B6%E5%AE%9E%E7%8E%B0_%E5%BC%80%E7%AF%87.html" title="Learn_Vulkan02_渲染框架实现_开篇" target="_blank">Learn_Vulkan02_渲染框架实现_开篇</a>
    </li>
    
    <li>
        <a href="http://www.adiosy.com/posts/learn_vulkan/learn_vulkan01_%E9%87%8D%E8%A6%81%E5%AF%B9%E8%B1%A1%E6%B5%85%E6%9E%90.html" title="Learn_Vulkan01_重要对象浅析" target="_blank">Learn_Vulkan01_重要对象浅析</a>
    </li>
    
    <li>
        <a href="http://www.adiosy.com/posts/learn_vulkan/learn_vulkan00_%E7%AC%AC%E4%B8%80%E4%B8%AA%E4%B8%89%E8%A7%92%E5%BD%A2.html" title="Learn_Vulkan00_第一个三角形" target="_blank">Learn_Vulkan00_第一个三角形</a>
    </li>
    
    <li>
        <a href="http://www.adiosy.com/posts/hello-openxr-%E7%AC%AC%E4%B8%80%E4%B8%AAopenxr%E7%A8%8B%E5%BA%8F.html" title="Hello OpenXR - 第一个OpenXR程序" target="_blank">Hello OpenXR - 第一个OpenXR程序</a>
    </li>
    
    <li>
        <a href="http://www.adiosy.com/posts/%E5%A4%9A%E5%B1%82%E8%8F%9C%E5%8D%95%E6%95%B0%E6%8D%AE%E6%9F%A5%E8%AF%A2.html" title="多层菜单数据查询" target="_blank">多层菜单数据查询</a>
    </li>
    
    <li>
        <a href="http://www.adiosy.com/posts/%E9%82%AE%E4%BB%B6%E6%9C%8D%E5%8A%A1%E5%99%A8.html" title="基于Apache james实现的Java邮件服务器" target="_blank">基于Apache james实现的Java邮件服务器</a>
    </li>
    
    <li>
        <a href="http://www.adiosy.com/posts/linux%E4%B8%8B%E5%AE%89%E8%A3%85nginx.html" title="Linux下安装Nginx" target="_blank">Linux下安装Nginx</a>
    </li>
    
</ul>
    </section>

    
<section class="widget">
    <h3 class="widget-title" style="color:red">我的B站主页</h3>
    <ul class="widget-list">
        
        <li>
            <a href="https://b23.tv/ObMaagI" title="我的B站主页（求关注~）" target="_blank" style="color:red">
                
                    <img src="/posts/assets/qrcode_b.jpg">
                
            </a>
        </li>
        
    </ul>
</section>


    <section class="widget">
        <h3 class="widget-title"><a href='/categories/'>Categories</a></h3>
<ul class="widget-list">
    
    <li><a href="http://www.adiosy.com/categories/openxr.html">OpenXR (1)</a></li>
    
    <li><a href="http://www.adiosy.com/categories/vulkan.html">Vulkan (4)</a></li>
    
    <li><a href="http://www.adiosy.com/categories/yuv.html">YUV (1)</a></li>
    
</ul>
    </section>

    <section class="widget">
        <h3 class="widget-title"><a href='/tags/'>Tags</a></h3>
<div class="tagcloud">
    
    <a href="http://www.adiosy.com/tags/monado.html">Monado</a>
    
    <a href="http://www.adiosy.com/tags/opengl.html">OpenGL</a>
    
    <a href="http://www.adiosy.com/tags/openxr.html">OpenXR</a>
    
    <a href="http://www.adiosy.com/tags/vr/ar.html">VR/AR</a>
    
    <a href="http://www.adiosy.com/tags/vulkan.html">Vulkan</a>
    
    <a href="http://www.adiosy.com/tags/yuv.html">YUV</a>
    
    <a href="http://www.adiosy.com/tags/%E5%9B%BE%E5%BD%A2%E5%AD%A6.html">图形学</a>
    
</div>
    </section>

    
<section class="widget">
    <h3 class="widget-title">Links</h3>
    <ul class="widget-list">
        
        <li>
            <a target="_blank" href="https://github.com/xingchen0085" title="我的Github">我的Github</a>
        </li>
        
        <li>
            <a target="_blank" href="https://gitee.com/xingchen0085" title="我的Gitee">我的Gitee</a>
        </li>
        
        <li>
            <a target="_blank" href="https://potatomelon.com" title="土豆社区">土豆社区</a>
        </li>
        
    </ul>
</section>


    <section class="widget">
        <h3 class="widget-title">Meta</h3>
        <ul class="widget-list">
            <li><a href="http://www.adiosy.com/index.xml">RSS</a></li>
        </ul>
    </section>
</div>
            </div>
        </div>
    </div>
</body>

</html>